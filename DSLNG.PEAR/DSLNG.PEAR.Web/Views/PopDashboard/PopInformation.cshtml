@model DSLNG.PEAR.Web.ViewModels.PopDashboard.GetPopDashboardViewModel

@{
    ViewBag.Title = "PopInformation";
}
<div class="pop-information">
    <h2>Pop Information</h2>
    <div>
        <h4>@Model.Title</h4>
        <h4>@Model.Number</h4>
        <h4>@Model.Subtitle</h4>
    </div>
    <div class="row">
        <div class="col-md-5 border-style-1">
            <div class="info">
                <div class="sub-info">
                    <table class="table-info">
                        @* BACKGROUND/OBJECTIVE *@
                        <tr class="DashboardObjective">
                            <td colspan="2">
                                <h4>BACKGROUND/OBJECTIVE </h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.DashboardObjective) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="0" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="DashboardObjective" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </td>
                        </tr>
                        <tr class="DashboardObjective-info">
                            @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.DashboardObjective))
                            {
                                <td data-id="@item.Id" data-type="0" data-value="@item.Value">@item.Value</td>
                            }
                        </tr>

                        @* KEY PERFORMANCE MEASURE *@
                        <tr class="KeyPerformanceMeasure">
                            <td colspan="2">
                                <h4>KEY PERFORMANCE MEASURE: RESULT (optional)</h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.KeyPerformanceMeasure) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="1" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="KeyPerformanceMeasure" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </td>
                        </tr>
                        <tr class="KeyPerformanceMeasure-info">
                            @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.KeyPerformanceMeasure))
                            {
                                <td data-id="@item.Id" data-type="1" data-value="@item.Value">@item.Value</td>
                            }
                        </tr>

                        @* BENEFITS *@
                        <tr class="Benefits">
                            <td colspan="2">
                                <h4>BENEFITS</h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.Benefits) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="2" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="Benefits" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </td>
                        </tr>
                        <tr class="Benefits-info">
                            @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.Benefits))
                            {
                                <td data-id="@item.Id" data-type="2" data-value="@item.Value">@item.Value</td>
                            }
                        </tr>

                        @* POTENTIAL PROBLEM & RISK *@
                        <tr class="PotentialProblemRisk">
                            <td colspan="2">
                                <h4>POTENTIAL PROBLEM & RISK</h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.PotentialProblemRisk) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="3" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="PotentialProblemRisk" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </td>
                        </tr>
                        <tr class="PotentialProblemRisk-info">
                            @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.PotentialProblemRisk))
                            {
                                <td data-id="@item.Id" data-type="3" data-value="@item.Value">@item.Value</td>
                            }
                        </tr>

                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-7 border-style-1">
            <div class="info">
                <div class="subinfo">
                    <table class="table-info-2" border="1">
                        <tr>
                            <th rowspan="2" class="SupporttingDataNeeded">
                                <h4>SUPPORTING DATA NEEDED</h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.SupporttingDataNeeded) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="4" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="SupporttingDataNeeded" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </th>
                            <th colspan="4"><h4>STRUCTURE</h4> </th>
                        </tr>
                        <tr>
                            <th class="StructureMember">
                                <h4>MEMBER</h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.StructureMember) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="5" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="StructureMember" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </th>
                            <th class="StructureLeader">
                                <h4>LEADER</h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.StructureLeader) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="6" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="StructureLeader" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </th>
                            <th class="StructureOwner">
                                <h4>OWNER</h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.StructureOwner) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="7" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="StructureOwner" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </th>
                            <th class="StructureAdvisor">
                                <h4>ADVISOR/STEERING COMMITTEE (if any)</h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.StructureAdvisor) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="8" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="StructureAdvisor" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </th>
                        </tr>
                        <tr>
                            <td class="SupporttingDataNeeded-info">
                                @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.SupporttingDataNeeded))
                                {
                                    <span data-id="@item.Id" data-type="4" data-value="@item.Value">@item.Value</span>
                                }
                            </td>
                            <td class="StructureMember-info">
                                @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.StructureMember))
                                {
                                    <span data-id="@item.Id" data-type="5" data-value="@item.Value">@item.Value</span>
                                }
                            </td>
                            <td class="StructureLeader-info">
                                @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.StructureLeader))
                                {
                                    <span data-id="@item.Id" data-type="6" data-value="@item.Value">@item.Value</span>
                                }
                            </td>
                            <td class="StructureOwner-info">
                                @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.StructureOwner))
                                {
                                    <span data-id="@item.Id" data-type="7" data-value="@item.Value">@item.Value</span>
                                }
                            </td>
                            <td class="StructureAdvisor-info">
                                @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.StructureAdvisor))
                                {
                                    <span data-id="@item.Id" data-type="8" data-value="@item.Value">@item.Value</span>
                                }
                            </td>
                        </tr>
                        <tr class="Scope">
                            <td colspan="5">
                                <h4>Scope</h4>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.Scope) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="9" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>

                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="Scope" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                            </td>
                        </tr>
                        <tr class="Scope-info">
                            @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.Scope))
                            {
                                <td data-id="@item.Id" data-type="9" data-value="@item.Value">@item.Value</td>
                            }
                        </tr>
                        <tr>
                            <th colspan="5"><h4>Resources</h4></th>
                        </tr>
                        <tr>
                            <td><h6>Financial</h6></td>
                            <td class="ResourcesNonFinancial-info">
                                <h6>Non Financial</h6>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.ResourcesNonFinancial) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="10" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="ResourcesNonFinancial" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                                @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.ResourcesNonFinancial))
                                {
                                    <span data-id="@item.Id" data-type="10" data-value="@item.Value">@item.Value</span>
                                }
                            </td>
                            <td class="ResourcesRemark-info">
                                <h6>Remark</h6>
                                @if (Model.PopInformations.FirstOrDefault(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.ResourcesRemark) == null)
                                {
                                    <a href="#" data-toggle="popover" data-placement="right" data-type="11" data-dashboard-id="@Model.Id" data-id="0" class="add-item"><i class="fa fa-plus"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-dashboard-id="@Model.Id" data-type="ResourcesRemark" class="edit-link"><i class="fa fa-edit"></i></a>
                                }
                                @foreach (var item in Model.PopInformations.Where(x => x.Type == DSLNG.PEAR.Data.Enums.PopInformationType.ResourcesRemark))
                                {
                                    <span data-id="@item.Id" data-type="11" data-value="@item.Value">@item.Value</span>
                                }
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>


@* Modal create *@
<div class="form-information" style="display: none;">
    @using (Html.BeginForm("Create", "PopInformation", FormMethod.Post))
    {
        <div>
            <input type="hidden" name="id" />
            <input type="hidden" name="dashboardId" />
            <input type="hidden" name="type" />
            <input type="text" name="title" hidden="hidden" />
            <label>Desc</label>
            <input type="text" name="value" />

        </div>
        <div>
            <button type="button" class="btn btn-primary input-information">Add</button>
            @*<button class="btn btn-primary cancel-popover">Cancel</button>*@
        </div>

    }
</div>

@*Modal Edit  *@
<div class="form-edit-information" style="display: none;">
    @using (Html.BeginForm("Create", "PopInformation", FormMethod.Post))
    {
        <div>
            <input type="hidden" name="id" />
            <input type="hidden" name="dashboardId" />
            <input type="hidden" name="type" />
            <input type="text" name="title" hidden="hidden" />
            <label>Desc</label>
            <input type="text" name="value" />

        </div>
        <div>
            <button type="button" class="btn btn-primary edit-information">Edit</button>
            @*<button class="btn btn-primary cancel-popover">Cancel</button>*@
        </div>

    }
</div>


@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {

            $(document).on('click', '.add-item', function () {
                var id = $(this).data('id');
                var dashboardId = $(this).data('dashboard-id');
                var type = $(this).data('type');
                $('.popover').find('input[name="id"]').attr('value', id);
                $('.popover').find('input[name="dashboardId"]').attr('value', dashboardId);
                $('.popover').find('input[name="type"]').attr('value', type);
                popOverElem = $(this);

            });

            $('body').popover({
                selector: '.add-item',
                html: true,
                title: function () {
                    return 'Test';
                },
                content: function () {
                    return $('.form-information').html();
                }
            });
            $('tr').popover({
                selector: '.edit-link',
                html: true,
                title: function () {
                    return 'Test';
                },
                content: function () {
                    return $('.form-edit-information').html();
                }
            });

            $(document).on('click', '.input-information', function (e) {
                e.preventDefault();
                var $that = $(this);
                $.ajax({
                    url: '@Url.Action("Create", "PopInformation")',
                    data: $that.closest('form').serialize(),
                    type: 'POST',
                    success: function (data) {
                        if (data.typeInt == 0 || data.typeInt == 1 || data.typeInt == 2 || data.typeInt == 3 || data.typeInt == 9) {
                            $('.' + data.type + '-info').append('<td data-id="' + data.id + '" data-type="' + data.typeInt + '" data-value="' + data.value + '">' + data.value + '</td>');
                            popOverElem.popover('hide');
                            $('.' + data.type).find('td').find('a').remove();
                            $('.' + data.type).find('td').append('<a href="#" data-dashboard-id="@Model.Id" data-type="' + data.type + '" class="edit-link"><i class="fa fa-edit"></i></a>');
                        }
                        else if (data.typeInt == 4 || data.typeInt == 5 || data.typeInt == 6 || data.typeInt == 7 || data.typeInt == 8) {
                            $('.' + data.type + '-info').append('<span data-id="' + data.id + '" data-type="' + data.typeInt + '" data-value="' + data.value + '">' + data.value + '</span>');
                            popOverElem.popover('hide');
                            $('.' + data.type).find('a').remove();
                            $('.' + data.type).append('<a href="#" data-dashboard-id="@Model.Id" data-type="' + data.type + '" class="edit-link"><i class="fa fa-edit"></i></a>');
                        }
                        else {

                            $('.' + data.type + '-info').append('<span data-id="' + data.id + '" data-type="' + data.typeInt + '" data-value="' + data.value + '">' + data.value + '</span>');
                            popOverElem.popover('hide');

                            $('.' + data.type + '-info').find('a').remove();
                            $('.' + data.type + '-info').append('<a href="#" data-dashboard-id="@Model.Id" data-type="' + data.type + '" class="edit-link"><i class="fa fa-edit"></i></a>');

                        }
                    }
                });
            });

            $(document).on('click', '.edit-information', function (e) {
                e.preventDefault();
                var $that = $(this);
                $.ajax({
                    url: '@Url.Action("Edit", "PopInformation")',
                    data: $that.closest('form').serialize(),
                    type: 'POST',
                    success: function (data) {
                        if (data.typeInt == 0 || data.typeInt == 1 || data.typeInt == 2 || data.typeInt == 3 || data.typeInt == 9) {
                            $('.' + data.type + '-info').find('td').remove();
                            $('.' + data.type + '-info').append('<td data-id="' + data.id + '" data-type="' + data.typeInt + '" data-value="' + data.value + '">' + data.value + '</td>');
                            popOverElem.popover('hide');
                        }
                        else if (data.typeInt == 4 || data.typeInt == 5 || data.typeInt == 6 || data.typeInt == 7 || data.typeInt == 8) {
                            $('.' + data.type + '-info').find('span').remove();
                            $('.' + data.type + '-info').append('<span data-id="' + data.id + '" data-type="' + data.typeInt + '" data-value="' + data.value + '">' + data.value + '</span>');
                            popOverElem.popover('hide');
                        }
                        else {
                            $('.' + data.type + '-info').find('span').remove();
                            $('.' + data.type + '-info').append('<span data-id="' + data.id + '" data-type="10" data-value="' + data.value + '">' + data.value + '</span>')
                            popOverElem.popover('hide');
                        }


                    }
                });
            });


            $(document).on('click', '.edit-link', function () {
                var $that = $(this);
                var type = $that.data('type');
                $table = $that.closest('table');
                $td = $table.find('.' + type + '-info').find('td');
                $span = $table.find('.' + type + '-info').find('span');

                var id = $td.data('id')
                var type = $td.data('type');
                var value = $td.data('value');
                var dashboardId = $that.data('dashboard-id');

                var id2 = $span.data('id')
                var type2 = $span.data('type');
                var value2 = $span.data('value');


                $('.popover').find('input[name="id"]').attr('value', id);
                $('.popover').find('input[name="dashboardId"]').attr('value', dashboardId);
                $('.popover').find('input[name="type"]').attr('value', type);
                $('.popover').find('input[name="value"]').attr('value', value);

                $('.popover').find('input[name="id"]').attr('value', id2);
                $('.popover').find('input[name="dashboardId"]').attr('value', dashboardId);
                $('.popover').find('input[name="type"]').attr('value', type2);
                $('.popover').find('input[name="value"]').attr('value', value2);



                popOverElem = $(this);
            });
        });
    </script>
}