@model DSLNG.PEAR.Web.ViewModels.EnvironmentScanning.EnvironmentScanningViewModel

@{
    ViewBag.Title = "EnvironmentsScanning";
}

<div class="col-md-12">
    <div class="row row-style">Ultimate Objective</div>
    <div class="row">
        <div class="col-md-4">
            <h4>Ultimate Objective (Construction Phase)</h4>
            <button type="button" class="btn btn-lg btn-danger input-popover" data-es-id="@Model.Id" data-type="cp" data-toggle="popover" title="Construction Phase">Add</button>
            <ul class="cp-list">
                @foreach (var item in Model.ConstructionPhase)
                {
                    <li>@item.Description <button data-id="@item.Id" class="remove-button">Remove</button></li>

                }
            </ul>
            @Html.HiddenFor(model => model.Id)
        </div>
        <div class="col-md-4">
            <h4>Ultimate Objective (Operation Phase)</h4>
            <button type="button" class="btn btn-lg btn-danger input-popover" data-es-id="@Model.Id" data-type="op" data-toggle="popover" title="Operation Phase">Add</button>
            <ul class="op-list">
                @foreach (var item in Model.OperationPhase)
                {
                    <li>@item.Description <button data-id="@item.Id" class="remove-button">Remove</button></li>

                }
            </ul>
        </div>
        <div class="col-md-4">
            <h4>Ultimate Objective (Decomm./Re-Invent Phase)</h4>
            <button type="button" class="btn btn-lg btn-danger input-popover" data-es-id="@Model.Id" data-type="rp" data-toggle="popover" title="Reinvent Phase">Add</button>
            <ul class="rp-list">
                @foreach (var item in Model.ReinventPhase)
                {
                    <li>@item.Description <button data-id="@item.Id" class="remove-button">Remove</button></li>

                }
            </ul>
        </div>
    </div>


    @*Environmental Scanning*@
    <div class="row row-style">Environmental Scanning</div>
    <div class="row">
        <div class="col-md-3 popover-envi">
            <h4>Threat </h4>
            <button type="button" class="btn btn-lg btn-danger input-environmental" data-envi-id="@Model.Id" data-envi-type="th" data-toggle="popover" title="Threat">Add</button>
            <ul class="th-list">
                @{
                    foreach (var item in Model.Threat)
                    {
                        <li>@item.Desc <button data-id="@item.Id" class="envi-remove-button">Remove</button></li>
                    }
                }
            </ul>

        </div>
        <div class="col-md-3 popover-envi">
            <h4>Opportunity</h4>
            <button type="button" class="btn btn-lg btn-danger input-environmental" data-envi-id="@Model.Id" data-envi-type="opp" data-toggle="popover" title="Opportunity">Add</button>
            <ul class="opp-list">
                @{
                    foreach (var item in Model.Opportunity)
                    {
                        <li>@item.Desc<button data-id="@item.Id" class="envi-remove-button">Remove</button> </li>
                    }
                }
            </ul>
        </div>
        <div class="col-md-3 popover-envi">
            <h4>Weakness</h4>
            <button type="button" class="btn btn-lg btn-danger input-environmental" data-envi-id="@Model.Id" data-envi-type="wk" data-toggle="popover" title="Weakness">Add</button>
            <ul class="wk-list">
                @{
                    foreach (var item in Model.Strength)
                    {
                        <li>@item.Desc <button data-id="@item.Id" class="envi-remove-button">Remove</button> </li>
                    }
                }
            </ul>
        </div>
        <div class="col-md-3 popover-envi">
            <h4>Strength</h4>
            <button type="button" class="btn btn-lg btn-danger input-environmental" data-envi-id="@Model.Id" data-envi-type="st" data-toggle="popover" title="Strength">Add</button>
            <ul class="st-list">
                @{
                    foreach (var item in Model.Weakness)
                    {
                        <li>@item.Desc <button data-id="@item.Id" class="envi-remove-button">Remove</button></li>
                    }
                }
            </ul>
        </div>
    </div>

    @* Constraints *@

    <div class="row row-style">
        Constraint
        <button type="button" style="float:right;" class="CreateClass" data-toggle="modal" data-target="#myModal" data-id="@Model.Id">Add</button>
    </div>


</div>


@* Modal *@

<div class="modal fade" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h3 class="modal-title">Input Data</h3>
            </div>

            <div class="modal-body">
                @using (Html.BeginForm())
                {
                    <div>
                        @Html.LabelFor(model => model.Relation)
                        <button type="button" class="btn-relation" data-toggle="popover" title="Relation">Select Relation</button>
                    </div>
                    <div>
                        @Html.LabelFor(model => model.Definition)
                        @Html.TextAreaFor(model => model.Definition)
                    </div>
                    <div>
                        @Html.LabelFor(model => model.Type)
                        @Html.DropDownListFor(model => model.Type, Model.Types);
                    </div>
                    <div>
                        @Html.LabelFor(model => model.Category)
                        @Html.DropDownListFor(model => model.Category, Model.Categories);
                    </div>
                }


            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Submit</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="popover-content" style="display: none">

    @using (Html.BeginForm("Create", "EnvironmentScanning", FormMethod.Post, new { id = "form-input" }))
    {
        <label>Description</label>
        <input type="text" name="esId" hidden="hidden" />
        <input type="text" name="type" hidden="hidden" />
        <input type="text" name="Description" />
        <input type="submit" value="submit" class="form-es-submit" />
    }
</div>

<div class="popover-environmental" style="display: none">

    @using (Html.BeginForm("CreateEnvironmental", "EnvironmentScanning", FormMethod.Post, new { id = "form-input" }))
    {
        <label>Description</label>
        <input type="text" name="enviId" hidden="hidden" />
        <input type="text" name="enviType" hidden="hidden" />
        <input type="text" name="Description" />
        <input type="submit" value="submit" class="form-envi-submit" />
    }
</div>

@* for checkbox Enviromental *@
<div class="popover-relation" style="display: none; color:black;">
    <h4>Threat</h4>
    <form>
        @{
            foreach (var item in Model.Threat)
            {
                <input type="checkbox" id="@item.Id" name="threat" />@item.Desc
            }
        }
    </form>

    <h4>Opportunity</h4>
    <form>
        @{
            foreach (var item in Model.Opportunity)
            {
                <input type="checkbox" id="@item.Id" name="threat" />@item.Desc
            }
        }
    </form>
    <h4>Weakness</h4>
    <form>
        @{
            foreach (var item in Model.Weakness)
            {
                <input type="checkbox" id="@item.Id" name="threat" />@item.Desc
            }
        }
    </form>
    <h4>Strength</h4>
    <form>
        @{
            foreach (var item in Model.Strength)
            {
                <input type="checkbox" id="@item.Id" name="threat" />@item.Desc
            }
        }
    </form>
</div>





@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {

            $('.popover-envi').popover({
                selector: '.input-environmental',
                html: true,
                title: function () {
                    return 'test';
                },
                content: function () {
                    return $('.popover-environmental').html();
                }
            });

            $('.modal-body').popover({
                selector: '.btn-relation',
                html: true,
                title: function () {
                    return 'Test';
                },
                content: function () {
                    return $('.popover-relation').html();
                }
            });

            $('body').popover({
                selector: '.input-popover',
                html: true,
                title: function () {
                    return 'Test';
                },
                content: function () {
                    return $('.popover-content').html();
                }
            });

            var popOverElem;
            $(document).on('click', '.input-popover', function () {
                var esId = $(this).data("es-id");
                var type = $(this).data("type");
                $('.popover').find('input[name="esId"]').attr('value', esId);
                $('.popover').find('input[name="type"]').attr('value', type);
                popOverElem = $(this);

            });

            $(document).on('click', '.input-environmental', function () {
                var enviId = $(this).data("envi-id");
                var enviType = $(this).data("envi-type");
                $('.popover').find('input[name="enviId"]').attr('value', enviId);
                $('.popover').find('input[name="enviType"]').attr('value', enviType);
                popOverElem = $(this);

            });

            //$(document).on('click', '.btn-relation', function () {
            //    //$('[data-toggle="popover"]').popover()
            //    //console.log('test');
            //    //var myId = $(this).data("id");
            //    //$('.popover').find('input[name="MyId"]').attr('value', myId);
            //    //popOverElem = $(this);

            //});


            $(document).on('click', '.form-es-submit', function (e) {
                e.preventDefault();
                var $that = $(this);
                $.ajax({
                    url: '@Url.Action("Create", "EnvironmentScanning")',
                    data: $that.closest('form').serialize(),
                    type: 'POST',
                    success: function (data) {
                        if (data.type == "cp") {
                            $('.cp-list').append($('<li>' + data.description + '<button data-id="' + data.id + '" class="remove-button">Remove</button></li>'));
                            popOverElem.popover('hide');
                        }
                        else if (data.type == "op") {
                            $('.op-list').append($('<li>' + data.description + '<button data-id="' + data.id + '" class="remove-button">Remove</button></li>'));
                            popOverElem.popover('hide');
                        }
                        else if (data.type == "rp") {
                            $('.rp-list').append($('<li>' + data.description + '<button data-id="' + data.id + '" class="remove-button">Remove</button></li>'));
                            popOverElem.popover('hide');
                        }
                    }
                })
            });

            $(document).on('click', '.form-envi-submit', function (e) {
                e.preventDefault();
                var $that = $(this);
                $.ajax({
                    url: '@Url.Action("CreateEnvironmental", "EnvironmentScanning")',
                    data: $that.closest('form').serialize(),
                    type: 'POST',
                    success: function (data) {
                        if (data.type == "th") {
                            $('.th-list').append($('<li>' + data.description + '<button data-id="' + data.id + '" class="envi-remove-button">Remove</button></li>'));
                            popOverElem.popover('hide');
                        }
                        else if (data.type == "opp") {
                            $('.opp-list').append($('<li>' + data.description + '<button data-id="' + data.id + '" class="envi-remove-button">Remove</button></li>'));
                            popOverElem.popover('hide');
                        }
                        else if (data.type == "wk") {
                            $('.wk-list').append($('<li>' + data.description + '<button data-id="' + data.id + '" class="envi-remove-button">Remove</button></li>'));
                            popOverElem.popover('hide');
                        }
                        else if (data.type == "st") {
                            $('.st-list').append($('<li>' + data.description + '<button data-id="' + data.id + '" class="envi-remove-button">Remove</button></li>'));
                            popOverElem.popover('hide');
                        }
                    }
                })
            });


            $(document).on('click', '.remove-button', function () {
                var that = this;
                var id = $(that).data('id')
                $.ajax({
                    url: '@Url.Action("Delete", "EnvironmentScanning")',
                    data: { Id: id },
                    type: 'Post',
                    success: function (data) {
                        if (data.success === true) {
                            $(that).parent().remove();
                        }

                    }
                })
            });

            $('ul').on('click', '.envi-remove-button', function () {
                var that = this;
                var id = $(that).data('id')
                $.ajax({
                    url: '@Url.Action("DeleteEnvironmental", "EnvironmentScanning")',
                    data: { Id: id },
                    type: 'Post',
                    success: function (data) {
                        if (data.success === true) {
                            $(that).parent().remove();
                        }

                    }
                })
            });

        })
    </script>
}